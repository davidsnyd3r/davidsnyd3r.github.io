<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Region Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        
        /* Animated gradient background */
        .gradient-bg {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 25%, #1e1b4b 50%, #7c3aed 75%, #1e1b4b 100%);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .glow-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            border-radius: 2px;
            outline: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #8b5cf6;
            cursor: pointer;
            border: none;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .2s;
            border-radius: 20px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .2s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: #8b5cf6;
        }
        input:checked + .toggle-slider:before {
            transform: translateX(16px);
        }
    </style>
</head>
<body class="bg-gray-950 gradient-bg">
    <!-- Animated orbs for depth -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="glow-orb w-96 h-96 bg-purple-600/20 -top-48 -left-48"></div>
        <div class="glow-orb w-96 h-96 bg-blue-600/20 -bottom-48 -right-48" style="animation-delay: 5s;"></div>
        <div class="glow-orb w-64 h-64 bg-violet-600/20 top-1/2 left-1/2" style="animation-delay: 10s;"></div>
    </div>
    
    <div id="app" class="min-h-screen flex flex-col relative z-10">
        <!-- Header -->
        <div class="border-b border-white/10 bg-gray-900/50 backdrop-blur-xl">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-semibold text-white tracking-tight">Constraint Region Explorer</h1>
                        <p class="text-sm text-gray-300/80 mt-0.5">3D visualization of constrained lattice points in ℝ³</p>
                    </div>
                    <div class="flex gap-2">
                        <button id="fullscreen-btn" onclick="toggleFullscreen()" class="px-3 py-2 bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-lg transition-all backdrop-blur-sm">
                            <svg id="fullscreen-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
                            </svg>
                        </button>
                        <button onclick="resetView()" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white border border-white/20 rounded-lg transition-all backdrop-blur-sm">
                            Reset View
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 max-w-7xl mx-auto w-full p-6">
            <div class="grid grid-cols-1 lg:grid-cols-[1fr,360px] gap-6 h-full">
                <!-- Visualization -->
                <div class="bg-white/5 backdrop-blur-md rounded-2xl border border-white/10 p-4 shadow-2xl">
                    <svg id="viz" class="w-full h-full rounded-lg" viewBox="0 0 900 600" style="cursor: grab; background: linear-gradient(145deg, #0f0a1f 0%, #1e1b4b 100%);">
                        <defs>
                            <radialGradient id="bgGrad">
                                <stop offset="0%" stop-color="#1e1b4b" stop-opacity="0.8"/>
                                <stop offset="100%" stop-color="#0f0a1f" stop-opacity="1"/>
                            </radialGradient>
                        </defs>
                        <rect width="900" height="600" fill="url(#bgGrad)"/>
                        <g id="main-group" transform="translate(450,300)"></g>
                    </svg>
                </div>

                <!-- Controls -->
                <div class="space-y-4 overflow-y-auto">
                    <!-- View Controls -->
                    <div class="bg-white/5 backdrop-blur-md rounded-xl border border-white/10 p-4 shadow-xl">
                        <h3 class="text-xs font-semibold text-gray-300 uppercase tracking-wider mb-4">View Controls</h3>
                        <div class="space-y-3">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-gray-400">Rotation</span>
                                    <span class="text-gray-300 font-mono" id="rotation-value">45°</span>
                                </div>
                                <input type="range" id="rotation" min="0" max="360" value="45" class="slider w-full bg-gray-700">
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-gray-400">Elevation</span>
                                    <span class="text-gray-300 font-mono" id="elevation-value">30°</span>
                                </div>
                                <input type="range" id="elevation" min="-90" max="90" value="30" class="slider w-full bg-gray-700">
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-gray-400">Zoom</span>
                                    <span class="text-gray-300 font-mono" id="zoom-value">1.0×</span>
                                </div>
                                <input type="range" id="zoom" min="0.5" max="3" step="0.1" value="1" class="slider w-full bg-gray-700">
                            </div>
                        </div>
                    </div>

                    <!-- Data Layers -->
                    <div class="bg-white/5 backdrop-blur-md rounded-xl border border-white/10 p-4 shadow-xl">
                        <h3 class="text-xs font-semibold text-gray-300 uppercase tracking-wider mb-4">Data Layers</h3>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-violet-500"></div>
                                    <span class="text-sm text-gray-300">Left Tube</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-left" checked>
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-emerald-500"></div>
                                    <span class="text-sm text-gray-300">Right Tube</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-right" checked>
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                    <span class="text-sm text-gray-300">Central Tube</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-central" checked>
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-amber-500"></div>
                                    <span class="text-sm text-gray-300">Radical Vector</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-radical" checked>
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <div class="w-3 h-3 rounded-full bg-gray-500"></div>
                                    <span class="text-sm text-gray-300">Root Points</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-roots" checked>
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <div class="flex items-center gap-2">
                                    <span class="text-red-500">★</span>
                                    <span class="text-sm text-gray-300">Invalid Points</span>
                                </div>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-invalid">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Display Options -->
                    <div class="bg-white/5 backdrop-blur-md rounded-xl border border-white/10 p-4 shadow-xl">
                        <h3 class="text-xs font-semibold text-gray-300 uppercase tracking-wider mb-4">Display</h3>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span class="text-sm text-gray-300">Axes</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-axes" checked>
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm text-gray-300">Grid</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-grid">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Transformations/Iterations -->
                    <div class="bg-white/5 backdrop-blur-md rounded-xl border border-white/10 p-4 shadow-xl">
                        <h3 class="text-xs font-semibold text-gray-300 uppercase tracking-wider mb-4">Transformations</h3>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span class="text-sm text-gray-300 font-mono">T¹ (+2, +4, +2)</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-iter1">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm text-gray-300 font-mono">T² (+4, +8, +4)</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-iter2">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm text-gray-300 font-mono">T³ (+6, +12, +6)</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-iter3">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="text-sm text-gray-300 font-mono">T⁴ (+8, +16, +8)</span>
                                <div class="toggle-switch">
                                    <input type="checkbox" id="show-iter4">
                                    <span class="toggle-slider"></span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State variables
        let rotation = 45;
        let elevation = 30;
        let zoom = 1;
        let isDragging = false;
        let lastMouse = { x: 0, y: 0 };

        // Point data
        const points = {
            right: [[0, 3, 3], [1, 3, 3], [2, 4, 3]],
            left: [[3, 3, 0], [3, 3, 1], [3, 4, 2]],
            central: [[0, 3, 0], [2, 6, 2], [2, 5, 2]],
            radical: [[2, 4, 2]],
            invalid: [[2,4,4],[0,4,2],[2,4,0],[4,4,2]],
            roots: [
                [0,1,0],[0,1,1],[0,2,1],[1,1,0],[0,2,0],
                [0,2,2],[1,2,0],[1,1,1],[0,3,2],
                [1,3,0],[1,2,2],[1,3,2],[0,3,1],[1,2,1],
                [1,3,1],[1,4,1],[1,4,2],[1,5,2],[1,5,1],
                [1,5,3],[2,4,1],[3,5,1],[2,5,4],
                [2,3,2],[2,3,1],[2,2,1],[2,3,3],[2,2,2],
                [2,3,0],[2,2,0],[4,5,4],[4,5,2],
                [3,5,4],[4,5,3],[3,4,3],[3,3,2],
                [3,3,3],[2,5,1]
            ]
        };

        // Colors
        const colors = {
            left: '#8b5cf6',
            right: '#10b981',
            central: '#3b82f6',
            radical: '#f59e0b',
            roots: '#6b7280',
            invalid: '#ef4444'
        };

        // Check constraints
        function satisfiesConstraints(x, y, z) {
            if (x < 0 || z < 0 || y < 0) return false;
            if (y < x || y < z) return false;
            if (Math.abs(z - x) > 2) return false;
            if (Math.abs(y - x - z) > 3) return false;
            if (Math.abs(y - 2*x) > 3) return false;
            if (Math.abs(y - 2*z) > 3) return false;
            return true;
        }

        // 3D to 2D projection
        function project(x, y, z) {
            const angleRad = (rotation * Math.PI) / 180;
            const elevationRad = (elevation * Math.PI) / 180;
            
            // Center the coordinate system
            const xCentered = x - 2.5;
            const yCentered = y - 6;
            const zCentered = z - 2.5;
            
            const xRotated = xCentered * Math.cos(angleRad) - zCentered * Math.sin(angleRad);
            const zRotated = xCentered * Math.sin(angleRad) + zCentered * Math.cos(angleRad);
            const yRotated = yCentered * Math.cos(elevationRad) - zRotated * Math.sin(elevationRad);
            
            const scale = 30 * zoom;
            return {
                x: xRotated * scale,
                y: -yRotated * scale
            };
        }

        // Draw function
        function draw() {
            const g = document.getElementById('main-group');
            g.innerHTML = '';
            
            // Draw grid
            if (document.getElementById('show-grid').checked) {
                for (let i = 0; i <= 10; i += 2) {
                    const line1 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const p1 = project(i, 0, 0);
                    const p2 = project(i, 0, 10);
                    line1.setAttribute('x1', p1.x);
                    line1.setAttribute('y1', p1.y);
                    line1.setAttribute('x2', p2.x);
                    line1.setAttribute('y2', p2.y);
                    line1.setAttribute('stroke', '#374151');
                    line1.setAttribute('stroke-width', '0.5');
                    line1.setAttribute('opacity', '0.3');
                    g.appendChild(line1);
                    
                    const line2 = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const p3 = project(0, 0, i);
                    const p4 = project(10, 0, i);
                    line2.setAttribute('x1', p3.x);
                    line2.setAttribute('y1', p3.y);
                    line2.setAttribute('x2', p4.x);
                    line2.setAttribute('y2', p4.y);
                    line2.setAttribute('stroke', '#374151');
                    line2.setAttribute('stroke-width', '0.5');
                    line2.setAttribute('opacity', '0.3');
                    g.appendChild(line2);
                }
            }
            
            // Draw axes
            if (document.getElementById('show-axes').checked) {
                const axes = [
                    { start: [0,0,0], end: [8,0,0], color: '#ef4444', label: 'x' },
                    { start: [0,0,0], end: [0,15,0], color: '#22c55e', label: 'y' },
                    { start: [0,0,0], end: [0,0,8], color: '#3b82f6', label: 'z' }
                ];
                
                axes.forEach(axis => {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    const start = project(...axis.start);
                    const end = project(...axis.end);
                    line.setAttribute('x1', start.x);
                    line.setAttribute('y1', start.y);
                    line.setAttribute('x2', end.x);
                    line.setAttribute('y2', end.y);
                    line.setAttribute('stroke', axis.color);
                    line.setAttribute('stroke-width', '2');
                    line.setAttribute('opacity', '0.6');
                    g.appendChild(line);
                    
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', end.x + 10);
                    text.setAttribute('y', end.y + 5);
                    text.setAttribute('fill', axis.color);
                    text.setAttribute('font-size', '14');
                    text.setAttribute('font-weight', '600');
                    text.textContent = axis.label;
                    g.appendChild(text);
                });
            }
            
            // Draw points
            function drawPoint(point, color) {
                const p = project(...point);
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', p.x);
                circle.setAttribute('cy', p.y);
                circle.setAttribute('r', 5);
                circle.setAttribute('fill', color);
                circle.setAttribute('stroke', '#fff');
                circle.setAttribute('stroke-width', '0.5');
                circle.setAttribute('stroke-opacity', '0.3');
                g.appendChild(circle);
            }
            
            // Draw star for invalid points
            function drawStar(point) {
                const p = project(...point);
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const pts = [];
                for (let i = 0; i < 10; i++) {
                    const radius = i % 2 === 0 ? 7 : 3.5;
                    const angle = (Math.PI / 5) * i - Math.PI / 2;
                    pts.push(`${p.x + radius * Math.cos(angle)},${p.y + radius * Math.sin(angle)}`);
                }
                star.setAttribute('points', pts.join(' '));
                star.setAttribute('fill', colors.invalid);
                star.setAttribute('stroke', '#fff');
                star.setAttribute('stroke-width', '0.5');
                star.setAttribute('stroke-opacity', '0.3');
                g.appendChild(star);
            }
            
            // Filter special points from roots
            const isSpecialPoint = (point) => {
                const allSpecial = [...points.right, ...points.left, ...points.central, ...points.radical];
                return allSpecial.some(sp => sp[0] === point[0] && sp[1] === point[1] && sp[2] === point[2]);
            };
            
            const rootPoints = points.roots.filter(point => !isSpecialPoint(point));
            
            // Draw all points
            if (document.getElementById('show-left').checked) {
                points.left.filter(p => satisfiesConstraints(...p)).forEach(p => 
                    drawPoint(p, colors.left));
            }
            
            if (document.getElementById('show-right').checked) {
                points.right.filter(p => satisfiesConstraints(...p)).forEach(p => 
                    drawPoint(p, colors.right));
            }
            
            if (document.getElementById('show-central').checked) {
                points.central.filter(p => satisfiesConstraints(...p)).forEach(p => 
                    drawPoint(p, colors.central));
            }
            
            if (document.getElementById('show-radical').checked) {
                points.radical.filter(p => satisfiesConstraints(...p)).forEach(p => 
                    drawPoint(p, colors.radical));
            }
            
            if (document.getElementById('show-roots').checked) {
                rootPoints.forEach(p => drawPoint(p, colors.roots));
            }
            
            if (document.getElementById('show-invalid').checked) {
                points.invalid.forEach(p => drawStar(p));
                [...points.left, ...points.right, ...points.central, ...points.radical]
                    .filter(p => !satisfiesConstraints(...p))
                    .forEach(p => drawStar(p));
            }
        }

        // Event handlers
        document.getElementById('rotation').addEventListener('input', (e) => {
            rotation = parseInt(e.target.value);
            const rotValue = document.getElementById('rotation-value');
            if (rotValue) rotValue.textContent = rotation + '°';
            draw();
        });

        document.getElementById('elevation').addEventListener('input', (e) => {
            elevation = parseInt(e.target.value);
            const elevValue = document.getElementById('elevation-value');
            if (elevValue) elevValue.textContent = elevation + '°';
            draw();
        });

        document.getElementById('zoom').addEventListener('input', (e) => {
            zoom = parseFloat(e.target.value);
            const zoomValue = document.getElementById('zoom-value');
            if (zoomValue) zoomValue.textContent = zoom.toFixed(1) + '×';
            draw();
        });

        // Checkboxes
        ['show-left', 'show-right', 'show-central', 'show-radical', 'show-roots', 'show-invalid', 'show-axes', 'show-grid'].forEach(id => {
            document.getElementById(id).addEventListener('change', draw);
        });

        // Mouse controls
        const svg = document.getElementById('viz');
        
        svg.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouse = { x: e.clientX, y: e.clientY };
            svg.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const deltaX = e.clientX - lastMouse.x;
            const deltaY = e.clientY - lastMouse.y;
            
            rotation = (rotation + deltaX * 0.5) % 360;
            elevation = Math.max(-90, Math.min(90, elevation - deltaY * 0.5));
            
            const rotSlider = document.getElementById('rotation');
            const elevSlider = document.getElementById('elevation');
            const rotValue = document.getElementById('rotation-value');
            const elevValue = document.getElementById('elevation-value');
            
            if (rotSlider) rotSlider.value = rotation;
            if (elevSlider) elevSlider.value = elevation;
            if (rotValue) rotValue.textContent = Math.round(rotation) + '°';
            if (elevValue) elevValue.textContent = Math.round(elevation) + '°';
            
            lastMouse = { x: e.clientX, y: e.clientY };
            draw();
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            svg.style.cursor = 'grab';
        });

        svg.addEventListener('wheel', (e) => {
            e.preventDefault();
            zoom = Math.max(0.5, Math.min(3, zoom + (e.deltaY > 0 ? -0.1 : 0.1)));
            const zoomSlider = document.getElementById('zoom');
            const zoomValue = document.getElementById('zoom-value');
            if (zoomSlider) zoomSlider.value = zoom;
            if (zoomValue) zoomValue.textContent = zoom.toFixed(1) + '×';
            draw();
        });

        // Reset view
        function resetView() {
            rotation = 45;
            elevation = 30;
            zoom = 1;
            
            const rotSlider = document.getElementById('rotation');
            const elevSlider = document.getElementById('elevation');
            const zoomSlider = document.getElementById('zoom');
            const rotValue = document.getElementById('rotation-value');
            const elevValue = document.getElementById('elevation-value');
            const zoomValue = document.getElementById('zoom-value');
            
            if (rotSlider) rotSlider.value = rotation;
            if (elevSlider) elevSlider.value = elevation;
            if (zoomSlider) zoomSlider.value = zoom;
            if (rotValue) rotValue.textContent = rotation + '°';
            if (elevValue) elevValue.textContent = elevation + '°';
            if (zoomValue) zoomValue.textContent = zoom.toFixed(1) + '×';
            
            draw();
        }

        // Fullscreen with proper icon switching
        function toggleFullscreen() {
            const icon = document.getElementById('fullscreen-icon');
            
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    // Change to exit fullscreen icon
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"></path>';
                }).catch(err => {
                    console.log('Error entering fullscreen:', err);
                });
            } else {
                document.exitFullscreen().then(() => {
                    // Change back to enter fullscreen icon
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>';
                }).catch(err => {
                    console.log('Error exiting fullscreen:', err);
                });
            }
        }
        
        // Listen for fullscreen changes (in case user presses ESC)
        document.addEventListener('fullscreenchange', () => {
            const icon = document.getElementById('fullscreen-icon');
            if (!document.fullscreenElement) {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>';
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'f' || e.key === 'F') {
                toggleFullscreen();
            } else if (e.key === 'r' || e.key === 'R') {
                resetView();
            }
        });

        // Initial draw
        draw();
    </script>
</body>
</html>
